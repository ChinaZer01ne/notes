# 电商系统



## 支付模块



### 支付宝接入

[支付宝官方文档](https://docs.open.alipay.com/194/105170/)



#### 扫码支付流程



![img](images/电商系统/支付/支付宝扫码支付流程)



#### 退款流程

![img](images/电商系统/支付/支付宝退款流程)



## 秒杀系统

### 特点

* 大量并发，在某一时刻99%的用户涌入
* 有效请求数很低，可以认为有效请求数和库存数一致，可能99%以上的流量都是无效的
* 库存数据一致性要求严格，不能超卖



### 架构思路

* 数据分层次校验，上层尽量把无效请求过滤掉
* 上层可以是不精确的过滤
* 层层限流，最后一层做数据一致性校验，扣减库存



### 架构设计

* HTML、JS、CSS等静态文件存放CDN，缓存到用户端（APP/浏览器）
* 非实时动态数据（秒杀期间如商品标题、商品描述、图片URL列表、店铺信息、秒杀活动信息等）。这些数据缓存在用户访问链路中靠近用户的位置，粗过滤一部分流量，比如用户是否有秒杀资格、秒杀是否已结束等，这些数据实时性要求不高
* 实时数据如用户营销数据（如红包、折扣、商品库存等再过滤一批用户）
* 经过多层过滤最终落到数据库的流量已经很少，最终在数据库层面使用事务保证扣减库存准确性